sudo: required

dist: trusty

install:
  - go get -v github.com/spf13/hugo
  - sudo apt-get -qq update && sudo apt-get install -y --no-install-recommends texlive-latex-base texlive-fonts-recommended texlive-fonts-extra texlive-latex-extra

script:
  # build blog
  - cd blog && hugo && cd ..
  # build CV
  - cd cv && mkdir build && pdflatex -interaction=nonstopmode -halt-on-error -output-directory build CV.tex && cd ..

before_deploy:
  - npm i netlify-cli -g

deploy:
  # Deploy to Github Releases
  provider: releases
  api_key: '$GITHUB_ACCESS_TOKEN'
  file:
    - 'cv/build/CV.pdf'
  skip_cleanup: true
  on:
    tags: true

after_deploy:
  # Deploy to Netlify
  - netlify deploy -t $NETLIFY_ACCESS_TOKEN -s $NETLIFY_SITE_ID -p blog/public
